kind: Deployment
replicaCount: 1

rbac:
  create: false

image:
  repository: {{ image_repository }}
  pullPolicy: Always
  tag: {{ image_tag }}

resources:
  limits:
    cpu: 12
    memory: 10Gi
  requests:
    cpu: 12
    memory: 10Gi


extraVolumes:
  - name: gcs-credentials
    secret:
      secretName: google_service_account_sa_key

  - name: testing-data-storage
    persistentVolumeClaim:
      claimName: testing-data-claim

extraVolumeMounts:
  - name: testing-data-storage
    mountPath: /data/

  - name: gcs-credentials
    mountPath: /google_service_credentials.json
    subPath: google_service_credentials.json

config:
  service: |
    [SERVICE]
        Daemon Off
        Log_Level debug
        HTTP_Server On
        HTTP_Listen 0.0.0.0
        HTTP_Port 2020
        flush        0.5
        HTTP_Server  On
        HTTP_Listen  0.0.0.0
        HTTP_PORT    2020
        storage.metrics           on
        storage.path              /tmp/storage
        storage.sync              normal
        storage.checksum          off
        storage.backlog.mem_limit 10G
        storage.max_chunks_up     100
  inputs: |
    [INPUT]
        Name                tail
        Path                /data/test.log
        storage.type        filesystem
        Buffer_Chunk_Size   32000
        Buffer_Max_Size     32000
  outputs: |
    [OUTPUT]
        Name        stackdriver
        storage.total_limit_size    10737418240
        Alias       output_main
        Match       *
        workers    10
        google_service_credentials /google_service_credentials.json